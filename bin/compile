#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

BUILD_DIR=$1
CACHE_DIR=$2
LP_DIR=`cd $(dirname $0); cd ..; pwd`


function indent() {
  c='s/^/       /'
  case $(uname) in
    Darwin) sed -l "$c";;
    *)      sed -u "$c";;
  esac
}

# Add executables to path
export PATH=$CACHE_DIR/node/bin:$PATH

echo "----- Publish CircuitHub static assets"
cd $BUILD_DIR
$CACHE_DIR/node/bin/node --harmony $BUILD_DIR/node_modules/gulp/bin/gulp.js publish-assets
echo "Assets published" | indent

echo "----- Delete extraneous tools"
rm -rf $BUILD_DIR/node_modules/gulp
rm -rf $BUILD_DIR/node_modules/gulp-*
rm -rf $BUILD_DIR/node_modules/xmlbuilder
rm -rf $BUILD_DIR/node_modules/xml2js
echo "Deleted extraneous tools" | indent
